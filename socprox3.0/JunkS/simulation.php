<?php$request = "simulation";include "templates/head.php";$restRoot=$GLOBALS["REST_SYS_ROOT"];require $restRoot."testcontroller.php";require 'config/dbConfig.php';$json_pop='0';$rest_pop='0';$restRoot=$GLOBALS["REST_URL_ROOT"];function verificationStatus($verfyID){    $ststus='';    switch($verfyID){        case '0':            $ststus='good';            break;        case '1':            $ststus='there is no user that is verifying the action (theoretically should never happen';            break;        case '2':            $ststus='there is no challenge instance';            break;        case '3':            $ststus='there are no users associated with the challenge';            break;    }    return $ststus;}function getSingleResult($config,$sql){    // echo $sql;    $mysqli=mysql_local_connect($config);    $dbname=$config['db_name'];    $rs=$mysqli->query($sql);    $rows= array();    $rows=$rs->fetch_array();    $count=0;    $row = $rows[0];    $mysqli->close();    return $row;}//socx_debug($_REQUEST['json']);if(!isset($_REQUEST['json'])){    $_REQUEST['json']='0';    $json_pop='1';}if($_REQUEST['json']=='json_gen') {    $json_pop='0';} elseif ($_REQUEST['json']=='json_gen1'){    $json_pop='0';}if(isset($_REQUEST['CompleteRestFP'])){    //echo "<br>".$_REQUEST['CompleteRestFP'];    $CompeteRestFP=explode('<~~>',$_REQUEST['CompleteRestFP']);}else{    $CompeteRestFP=array();}//var_dump($CompeteRestFP);if (!isset($_REQUEST['RESTCALL'])) {        $_REQUEST['RESTCALL']='0';        //$_REQUEST['InterceptRestResp']='0';        $rest_pop='1';    socx_debug("HIT");}if($_REQUEST['RESTCALL']=='0') {    $rest_pop='1';}elseif($_REQUEST['RESTCALL']=='rest_gen') {    $rest_pop='2';} elseif ($_REQUEST['RESTCALL']=='rest_gen1'){    $rest_pop='0';}?><div id="content" class="container"><div class="row">    <button id="restart" type="button" class="btn btn-primary" data-loading-text="Loading...">Restart</button></div><?phpecho "<div class='rounded-corners2'><table class='listings' id='simulation'>";if($GLOBALS['JSON_INTERCEPT']=='1' && $json_pop!='0'){ // Simulation Startup    //$JSON_CASE='1';    $JSON_URL=$restRoot."users";    include("JSONInterceptor.php");}else {    $uUsers = json_decode (file_get_contents($restRoot."users"), true);//    $json_pop='1';}$users = $uUsers['body'];if(isset($_GET["mac"])):    socx_debug( "<br> 1 if isset _GET[\"mac\"]");    $sListed = $_GET["mac"];    $aUsers = explode(" ", $sListed);    $mMac0 = $aUsers[0];    $mMac1 = $aUsers[1];    if(isset($_GET["cid"])):        socx_debug("<br> 2 if(isset(GET[\"cid\"])") ;        if(isset($_GET["update1"]) && isset($_GET["update2"])):            socx_debug( "<br> 3 if(isset(GET[\"update1\"]) && isset(GET[\"update2\"]))");            $sUpdate1 = $_GET["update1"];            $sInstanceID1 = explode(" ", $sUpdate1);            $sUpdate2 = $_GET["update2"];            $sInstanceID2 = explode(" ", $sUpdate2);            if(strcmp($sInstanceID1[0], "fail") && strcmp($sInstanceID1[0], "success") && isset($_REQUEST['verify']) && $_REQUEST['verify']=='verification'){                socx_debug("<br> 4 --if(strcmp(sInstanceID1[0], \"fail\") && strcmp(sInstanceID1[0], \"success\") && !isset(REQUEST['verify'])){");                $RestFP='RFP_1';                $RestParams=array();                $RestParams['$mMac0']=$mMac0;                $RestParams['$sInstanceID1[1]']=$sInstanceID1[1];                $RestParams['$sInstanceID1[0]']=$sInstanceID1[0];                $RestFunctionPrint='TestController::updateChallenge($mMac0, $sInstanceID1[1], $sInstanceID1[0])';                if($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop!='0' && !in_array($RestFP,$CompeteRestFP) ){                    //echo $RestFP."IF called";                    include("RESTInterceptor.php");                    //TestController::updateChallenge($mMac0, $sInstanceID1[1], $sInstanceID1[0]);                }elseif($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop=='2' && in_array($RestFP,$CompeteRestFP)!='0'){                   // echo $RestFP."Else IF called";                    $restResp=$_REQUEST['InterceptRestResp'];                }else{                   // echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                  //  var_dump($CompeteRestFP);                    TestController::updateChallenge($mMac0, $sInstanceID1[1], $sInstanceID1[0]);                }                    $RestFP='RFP_2';                    $RestParams=array();                    $RestParams['$mMac1']=$mMac1;                    $RestParams['$sInstanceID2[1]']=$sInstanceID2[1];                    $RestParams['$sInstanceID2[0]']=$sInstanceID2[0];                    $RestFunctionPrint='TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0])';                 //   echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                  //  echo "REST POP->".$rest_pop;                  //  var_dump($CompeteRestFP);                    if($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop!='0' && !in_array($RestFP,$CompeteRestFP) ){                  //      echo $RestFP."IF called";                        include("RESTInterceptor.php");                        //TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                    }elseif($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop=='2' && in_array($RestFP,$CompeteRestFP)!='0'){                  //      echo $RestFP."Else IF called";                        $restResp=$_REQUEST['InterceptRestResp'];                    }else{                 //       echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                        TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                    }                //echo "Status called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                /*if($GLOBALS['JSON_INTERCEPT']=='1' && $json_pop!='0'){                    $JSON_CASE='1';                    $JSON_URL=TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                    include("JSONInterceptor.php");                    //$uUsers = json_decode(file_get_contents($restRoot."users"), true);                }else {                    TestController::updateChallenge($mMac0, $sInstanceID1[1], $sInstanceID1[0]);                }	*/                //TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                echo "								<thread><tr><th scope='col'>Active Challenge</th><th scope='col'>User's Mac</th><th scope='col'>Success or Fail</th></tr></thread>								<tbody>								<tr>								<td>$sInstanceID1[1]</td><td>$mMac0</td>								<td><input class='selected' type='radio' name='update1' value='success+$sInstanceID1[1]'>Success</input></br>								<input class='selected' type='radio' name='update1' value='fail+$sInstanceID1[1]'>Fail</input>								</td>								<tr>								<td><button id='updateChallenge' type='button' class='btn btn-primary' disabled='disabled' data-loading-text='Loading...'>Submit</button></td>								<td>$mMac1</td>								<td><input class='selected' type='radio' name='update2' value='success+$sInstanceID1[1]'>Success</input></br>								<input class='selected' type='radio' name='update2' value='fail+$sInstanceID1[1]'>Fail</input>								</td>								</tr>								</tbody>								</table></div>   								";                $mac=$mMac0;                //hallengeInsID= $sInstanceID1[1];                //$challengeResult=$sInstanceID1[0];                $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address='$mac'";                $rows=getResults($config,$sql);                echo "<div style=\"float:left;width:25%;\" ><div class='rounded-corners' style=\"width: 90% ! important;\">							<div class='element-wrap'> <u> Player1 Summary  </u> <B style='float:right;'>  </B></div>";                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "	  </div></div>";                $mac=$mMac1	;                //$challengeInsID= $sInstanceID1[1];                //$challengeResult=$sInstanceID1[0];                $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address='$mac'";                $rows=getResults($config,$sql);                echo "<div style=\"float:left;width:25%;\" ><div class='rounded-corners' style=\"width: 90% ! important;\">							<div class='element-wrap'> <u> Player2 Summary  </u> <B style='float:right;'>  </B></div>";                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "</div></div>";                echo "<div class='rounded-corners' style='width:48%!important; min-height:300px;'>							<div class='element-wrap'> <u> Challenge Summary  </u> </div>";                $challengeInsID= $sInstanceID1[1];                $sql="select chi.ChallengeInstanceID as Instance_ID,chi.Status as Challenge_Status,chi.Accepts as Challenge_Accepts,							chi.Date as Challenge_date,ch.Internal_Name ,ch.Internal_Description,ch.Name as Challenge_Name,	ch.Instructions,							ch.Start_Date,ch.End_Date,ch.Start_Time,ch.End_Time,ch.P1_ID,ch.P2_ID,ch.P3_ID,ch.P4_ID,ch.Min_Players,ch.Max_Players,ch.VerificationID,							gm.GameID,gm.Name,gm.Description,gm.Criteria_to_Play,gm.Winning_Points,gm.Duration							from $challengeinstance as chi , $challenge as ch, $game as gm where chi.ChallengeID = ch.ChallengeID and ch.Game_ID = gm.GameID							and chi.ChallengeInstanceID='$challengeInsID'";                $rows=getResults($config,$sql);                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "	  </div>";            } elseif( $_REQUEST['verify']=='verification'){ // Verification Step                $locval1=$sInstanceID1[0]."+".$sInstanceID1[1];                $locval2=$sInstanceID2[0]."+".$sInstanceID2[1];                $RestFP='RFP_6';                $RestParams=array();                $RestParams['$sInstanceID1[1]']=$sInstanceID1[1];                $RestParams['$mMac0']=$mMac0;                $RestParams['$sInstanceID1[0]']=$sInstanceID1[0];                $RestFunctionPrint='TestController::verifyChallenge($sInstanceID1[1], $mMac0, $sInstanceID1[0])';                //echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);               // echo "REST POP->".$rest_pop;               // var_dump($CompeteRestFP);                if($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop!='0' && !in_array($RestFP,$CompeteRestFP) ){               //     echo $RestFP."IF called";                    include("RESTInterceptor.php");                    //TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                }elseif($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop=='2' && in_array($RestFP,$CompeteRestFP)!='0'){               //     echo $RestFP."Else IF called";                    $vrfy_1=$_REQUEST['InterceptRestResp'];                }else{               //     echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                    $vrfy_1=TestController::verifyChallenge($sInstanceID1[1], $mMac0, $sInstanceID1[0]);                }                $RestFP='RFP_7';                $RestParams=array();                $RestParams['$sInstanceID1[1]']=$sInstanceID1[1];                $RestParams['$mMac1']=$mMac1;                $RestParams['$sInstanceID2[0]']=$sInstanceID2[0];                $RestFunctionPrint='TestController::verifyChallenge($sInstanceID1[1], $mMac1, $sInstanceID2[0])';              //  echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);              //  echo "REST POP->".$rest_pop;               // var_dump($CompeteRestFP);                if($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop!='0' && !in_array($RestFP,$CompeteRestFP) ){              //      echo $RestFP."IF called";                    include("RESTInterceptor.php");                    //TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                }elseif($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop=='2' && in_array($RestFP,$CompeteRestFP)!='0'){                //    echo $RestFP."Else IF called";                    $vrfy_2=$_REQUEST['InterceptRestResp'];                }else{                //    echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                    $vrfy_2=TestController::verifyChallenge($sInstanceID1[1], $mMac1, $sInstanceID2[0]);                }                //$vrfy_1=TestController::verifyChallenge($sInstanceID1[1], $mMac0, $sInstanceID1[0]);                //$vrfy_2=TestController::verifyChallenge($sInstanceID1[1], $mMac1, $sInstanceID2[0]);              //  echo "TEST->VERIFY->". $vrfy_1;                $status1=verificationStatus($vrfy_1);                $status2=verificationStatus($vrfy_2);                socx_debug('<br> 5 if(REQUEST[\'verify\']==\'verification\')');                echo "								<thread><tr><th scope='col'>Active Challenge</th><th scope='col'>User's Mac</th><th scope='col'>Success or Fail</th>								<th scope='col'> Verification Status </th></tr></thread>								<tbody>								<tr>								    <td>$sInstanceID1[1]</td>								    <td>$mMac0</td>								    <td>$sInstanceID1[0]								    <input class='selected' type='hidden' name='update1' value='$locval1'>								    </td>								    <td> $status1 </td>								<tr>								    <td><button id='updateChallenge_verify' type='button' class='btn btn-primary'  data-loading-text='Loading...'>Submit</button></td>								    <td>$mMac1</td>							    	<td>$sInstanceID2[0]							    	<input class='selected' type='hidden' name='update2' value='$locval2'>							    	</td>							    	<td> $status2 </td>								</tr>								</tbody>								</table></div>								";                $mac=$mMac0;                //hallengeInsID= $sInstanceID1[1];                //$challengeResult=$sInstanceID1[0];                $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address='$mac'";                $rows=getResults($config,$sql);                echo "<div style=\"float:left;width:25%;\" ><div class='rounded-corners' style=\"width: 90% ! important;\">							<div class='element-wrap'> <u> Player1 Summary  </u> <B style='float:right;'>  </B></div>";                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "	  </div></div>";                echo "<div class='rounded-corners' style='width:58%!important; min-height:300px;'>							<div class='element-wrap'> <u> Challenge Summary  </u> </div>";                $challengeInsID= $sInstanceID1[1];                $sql="select chi.ChallengeInstanceID as Instance_ID,chi.Status as Challenge_Status,chi.Accepts as Challenge_Accepts,							chi.Date as Challenge_date,ch.Internal_Name ,ch.Internal_Description,ch.Name as Challenge_Name,	ch.Instructions,							ch.Start_Date,ch.End_Date,ch.Start_Time,ch.End_Time,ch.P1_ID,ch.P2_ID,ch.P3_ID,ch.P4_ID,ch.Min_Players,ch.Max_Players,ch.VerificationID,							gm.GameID,gm.Name,gm.Description,gm.Criteria_to_Play,gm.Winning_Points,gm.Duration							from $challengeinstance as chi , $challenge as ch, $game as gm where chi.ChallengeID = ch.ChallengeID and ch.Game_ID = gm.GameID							and chi.ChallengeInstanceID='$challengeInsID'";                $rows=getResults($config,$sql);                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "	  </div>";                $mac=$mMac1	;                //$challengeInsID= $sInstanceID1[1];                //$challengeResult=$sInstanceID1[0];                $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address='$mac'";                $rows=getResults($config,$sql);                echo "<div style=\"float:left;width:25%;\" ><div class='rounded-corners' style=\"width: 90% ! important;\">							<div class='element-wrap'> <u> Player2 Summary  </u> <B style='float:right;'>  </B></div>";                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "</div></div>";                // echo "LOU";            } else{                socx_debug( '<br> 6 else part of 1 and 5');                $RestFP='RFP_4';                $RestParams=array();                $RestParams['$mMac0']=$mMac0;                $RestParams['$sInstanceID1[1]']=$sInstanceID1[1];                $RestParams['$sInstanceID1[0]']=$sInstanceID1[0];                $RestFunctionPrint='TestController::updateChallenge($mMac0, $sInstanceID1[1], $sInstanceID1[0]);';               // echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);               // echo "REST POP->".$rest_pop;               // var_dump($CompeteRestFP);                if($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop!='0' && !in_array($RestFP,$CompeteRestFP) ){                //    echo $RestFP."IF called";                    include("RESTInterceptor.php");                    //TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                }elseif($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop=='2' && in_array($RestFP,$CompeteRestFP)!='0'){               //     echo $RestFP."Else IF called";                    $restResp=$_REQUEST['InterceptRestResp'];                }else{                //    echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                    TestController::updateChallenge($mMac0, $sInstanceID1[1], $sInstanceID1[0]);                }//                TestController::updateChallenge($mMac0, $sInstanceID1[1], $sInstanceID1[0]);               // TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                $RestFP='RFP_5';                $RestParams=array();                $RestParams['$mMac1']=$mMac1;                $RestParams['$sInstanceID2[1]']=$sInstanceID2[1];                $RestParams['$sInstanceID2[0]']=$sInstanceID2[0];                $RestFunctionPrint='TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0])';              //  echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);              //  echo "REST POP->".$rest_pop;               // var_dump($CompeteRestFP);                if($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop!='0' && !in_array($RestFP,$CompeteRestFP) ){               //     echo $RestFP."IF called";                    include("RESTInterceptor.php");                    //TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                }elseif($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop=='2' && in_array($RestFP,$CompeteRestFP)!='0'){               //     echo $RestFP."Else IF called";                    $restResp=$_REQUEST['InterceptRestResp'];                }else{               //     echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                    TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);                }                echo "<h1 align='center'>Successful Simulation!</h1>";                $sucCessCol1="";                $sucCessCol2="";                if(strcmp($sInstanceID1[0],"fail")==0){                    //$sucCessCol2="<span style=\"color:green;\">Success</span>";                    $sucCessCol1="<span style=\"color:red;\">Fail</span>";                }else{                    $sucCessCol1="<span style=\"color:green;\">Success</span>";                }                $mac=$mMac0;                $challengeInsID= $sInstanceID1[1];                $challengeResult=$sInstanceID1[0];                $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address='$mac'";                $rows=getResults($config,$sql);                echo "<div style=\"float:left;width:50%;\" ><div class='rounded-corners' style=\"width: 90% ! important;\">										<div class='element-wrap'> <u> Player1 Summary  </u> <B style='float:right;'> $sucCessCol1 </B></div>";                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "	  </div>";                if(strcmp($sInstanceID2[0],"fail")==0){                    //$sucCessCol1="<span style=\"color:green;\">Success</span>";                    $sucCessCol2="<span style=\"color:red;\">Fail</span>";                }else{                    $sucCessCol2="<span style=\"color:green;\">Success</span>";                }                $mac=$mMac1;                $challengeInsID= $sInstanceID1[1];                $challengeResult=$sInstanceID2[0];                $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address='$mac'";                $rows=getResults($config,$sql);                echo "<div class='rounded-corners' style=\"width: 90% ! important;\">										<div class='element-wrap'> <u> Player2 Summary  </u>  <B style='float:right;'> $sucCessCol2 </B></div>";                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val."</div></div>";                }                echo "	  </div></div>";                echo "<div class='rounded-corners' style='width:40%!important; min-height:300px;'>							<div class='element-wrap'> <u> Challenge Summary  </u> </div>";                $challengeInsID= $sInstanceID1[1];                $sql="select chi.ChallengeInstanceID as Instance_ID,									chi.Status as Challenge_Status,									chi.Accepts as Challenge_Accepts,									chi.Date as Challenge_date,									ch.Internal_Name ,									ch.Internal_Description,									ch.Name as Challenge_Name,									ch.Instructions,									ch.Start_Date,									ch.End_Date,									ch.Start_Time,ch.End_Time,ch.P1_ID,ch.P2_ID,ch.P3_ID									,ch.P4_ID,ch.Min_Players,ch.Max_Players,ch.VerificationID,									gm.GameID,gm.Name,gm.Description,gm.Criteria_to_Play,gm.Winning_Points,gm.Duration									 from $challengeinstance chi , $challenge ch, $game gm,$payoffs pf where 									 chi.ChallengeID = ch.ChallengeID and ch.Game_ID = gm.GameID 									 and ch.P1_ID= pf.PayoffID and chi.ChallengeInstanceID=$challengeInsID";                //echo $sql;                $rows=getResults($config,$sql);                foreach ($rows as $key => $val){                    echo "<div class='element-wrap'><div class='left-challenge'>".$key."</div><div class='right-challenge'>".$val;                    if($key=='P1_ID'||$key=='P2_ID'||$key=='P3_ID'||$key=='P4_ID'){                        $rowVal=getSingleResult($config,"select Name from $payoffs where PayoffID=$val limit 1");                        //socx_debug($rowVal);                        echo "  ".$rowVal;                    }                    echo "</div></div>";                }                echo "	  </div>";            }        else:            socx_debug( "<br> 7 else part of 3 ");            $RestFP='RFP_3';            $RestParams=array();            $RestParams['$mMac0']=$mMac0;            $RestParams['$mMac1']=$mMac1;            $RestParams['$_GET["cid"]']=$_GET["cid"];            $RestFunctionPrint='TestController::simChallenge($mMac0, $mMac1, $_GET["cid"])';            //echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);           // echo "REST POP->".$rest_pop;           // var_dump($CompeteRestFP);            if($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop!='0' && !in_array($RestFP,$CompeteRestFP) ){            //    echo $RestFP."IF called";                include("RESTInterceptor.php");                //TestController::updateChallenge($mMac1, $sInstanceID2[1], $sInstanceID2[0]);            }elseif($GLOBALS['REST_INTERCEPT']=='1' && $rest_pop=='2' && in_array($RestFP,$CompeteRestFP)!='0'){           //     echo $RestFP."Else IF called";                $oInstance=$_REQUEST['InterceptRestResp'];            }else{            //    echo $RestFP."Else called --> $rest_pop >" .in_array($RestFP,$CompeteRestFP);                $oInstance = TestController::simChallenge($mMac0, $mMac1, $_GET["cid"]);            }            //$oInstance = TestController::simChallenge($mMac0, $mMac1, $_GET["cid"]);            $instance = explode("/", $oInstance);            if($GLOBALS['JSON_INTERCEPT']=='1' && $json_pop!='0'){                //$_REQUEST['json']='0';                $JSON_URL=$restRoot."getChallengeInstance/".$mMac0."/".$instance[0];                //$_REQUEST['json']='0';                //echo "2";                include("JSONInterceptor.php");                // $uReturned = json_decode(file_get_contents($restRoot."getChallengeInstance/".$mMac0."/".$instance[0]),true);            }   else{                $uReturned = json_decode(file_get_contents($restRoot."getChallengeInstance/".$mMac0."/".$instance[0]),true);            }            echo "						<thread><tr><th scope='col'>Pending Challenge</th><th scope='col'>User Names</th><th scope='col'>Accept or Deny</th></tr></thread>						<tbody>						<tr>						<td>$instance[0]</td><td>$instance[1]</td>						<td><input class='selected' type='radio' name='update1' value='accepted+$instance[0]'>Accept</input></br>						<input class='selected' type='radio' name='update1' value='denied+$instance[0]'>Deny</input>						</td>						<tr><td><button id='updateChallenge' type='button' class='btn btn-primary' disabled='disabled' data-loading-text='Loading...'>Submit</button></td>						<td>$instance[2]</td>						<td><input class='selected' type='radio' name='update2' value='accepted+$instance[0]'>Accept</input></br>						<input class='selected' type='radio' name='update2' value='denied+$instance[0]'>Deny</input>						</td>						</tr>						</tbody>						</table></div>						";            $headHTML=gettableHeader(getColfromTab($config, $challenge));            $headHTML=str_replace("<th>", "", $headHTML);            $headHTMLArray=explode("</th>", $headHTML);            $data=getSingleSimulationTabData($config,'ChallengeID',$_GET["cid"],$challenge);            $data=str_replace("<td>", "", $data);            $dataArray=explode("</td>", $data);            echo "<div class='rounded-corners'><div class='element-wrap'> <u> Challenge Details </u></div>";            foreach ($headHTMLArray as $key => $val){                echo "<div class='element-wrap'>								<div class='left-challenge'> $val : </div>								<div class='right-challenge'> $dataArray[$key] </div>							  </div>";            }            echo "</div>";        endif;    else:        socx_debug('<br> 8 else part of 2') ;        echo "</table>";        $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address in ('$mMac0','$mMac1')";        $sqlChallengeTaken="select group_concat(distinct(c.Name ) SEPARATOR '<br>') as Challenges_done from $challenge c,$activity ac,$challengeinstance ci where				ac.ChallengeInstID=ci.ChallengeInstanceID and				ci.ChallengeID=c.ChallengeID and				ac.UserID=";        $sqlGamesPlayed="select group_concat(distinct(g.Name) SEPARATOR '<br>') as Games_Played from $activity ac,$challengeinstance ci,$challenge c,$game g,$user as u				where ci.ChallengeInstanceID=ac.ChallengeInstID and u.UserID=ac.UserID				and c.ChallengeID=ci.ChallengeID and g.GameID=c.Game_ID				and ac.UserID=";        $rows=getResultSets($config,$sql);        //$challangeTake=getChallengeTakeFromUser($config,$rows[0][0]);        //print_r($rows);        echo "<div class='rounded-corners' style=\"width: 90% ! important;\">				<div class='element-wrap'> <u> Player Summary  </u> </div>				<table class='listings' id='simulation'>				<thead><tr><th >UserID</th><th >User Name</th> <th >MAC Address</th><th >Name</th><th >Total Points</th>							<th >Challenges Taken</th><th >Game Played</th></thead><tbody>				";        $i=0;        $recCount=count($rows);        while ($recCount > $i){            echo "<tr>";            $j=0;            $tdCount=count($rows[$i]);            while ($tdCount> $j){                echo "<td>".$rows[$i][$j]."</td>";                if($j==4){                    //echo "TEST";                    echo "<td>".getChallengeTakeFromUser($config,$rows[$i]['0'],$sqlChallengeTaken)."</td>";                    echo "<td>".getGamesPlayFromUser($config,$rows[$i]['0'],$sqlGamesPlayed)."</td>";                }                $j++;            }            echo "</tr>";            $i++;        }        echo "</tbody></table>	  </div>";        echo "<table class='listings' id='simulation'>				<thead><tr><th scope='col'>Choice</th><th scope='col'>Challenge</th><th scope='col'>ID</th>";        $headHTML=gettableHeader(getColfromTab($config, $challenge));        echo $headHTML;        echo "</tr></thead><tbody>";        $sListed = $mMac0.'/'.$mMac1;        if($GLOBALS['JSON_INTERCEPT']=='1' && $json_pop!='0'){            //$_REQUEST['json']='0';            $JSON_URL=$restRoot."listChallenges/".$sListed;            //echo "3";            include("JSONInterceptor.php");            //$uReturned = json_decode(file_get_contents($restRoot."listChallenges/".$sListed), true);        }else{            $uReturned = json_decode(file_get_contents($restRoot."listChallenges/".$sListed), true);        }        $uList = $uReturned["body"];        foreach($uList as $u){            $cName = $u["m_strName"];            $cID = $u["m_iID"];            echo "				<tr>				<td><input class='selected' type='radio' name='chalChoice' value='$cID'></td>				<td>$cName</td>				<td>$cID</td>";            echo $data=getSingleSimulationTabData($config,'ChallengeID',$cID,$challenge);            echo"</tr>";        }        echo"					<tr>					<td style='text-align:left;' colspan='22'><button id='selChallenges' type='button' class='btn btn-primary' disabled='disabled' data-loading-text='Loading...'>Submit</button></td></tr>					</tbody></table></div>					";    endif;else:    socx_debug("<br> 9 else part of 1") ;    if($GLOBALS['JSON_INTERCEPT']=='1' && $json_pop!='0'){        //$_REQUEST['json']='0';        $JSON_URL=$restRoot."users";        include("JSONInterceptor.php");        //$uUsers = json_decode(file_get_contents($restRoot."users"), true);    }else{        $uUsers = json_decode(file_get_contents($restRoot."users"), true);    }    echo "				<thread><tr><th scope='col'>Include</th><th scope='col'>User</th><th scope='col'>MAC Address</th>				<th scope='col'>Name</th>				<th scope='col'>Total Points</th>				<th scope='col'>Challenge Played</th>				<th scope='col'>Game Played</th>				</tr></thread><tbody>";    $users = $uUsers['body'];    $total = 0;    foreach($users as $u){        $total++;        $mac = $u["m_strMac"];        $name = $u["m_strUsername"];        if($mac!='' || $mac != null){            $sql="select UserID,Username,MAC_Address,Name,Total_Points from $user where MAC_Address in ('$mac')";            $sqlChallengeTaken="select group_concat(distinct(c.Name ) SEPARATOR '<br>') as Challenges_done from $challenge c,$activity ac, $challengeinstance ci whereac.ChallengeInstID=ci.ChallengeInstanceID and ci.ChallengeID=c.ChallengeID and ac.UserID=";            $sqlGamesPlayed="select group_concat(distinct(g.Name) SEPARATOR '<br>') as Games_Played from $activity ac,$challengeinstance ci,$challenge c,$game g,$user as uwhere ci.ChallengeInstanceID=ac.ChallengeInstID and u.UserID=ac.UserID and c.ChallengeID=ci.ChallengeID and g.GameID=c.Game_ID and ac.UserID=";            $rows=getResultSets($config,$sql);            echo "				<tr><td><input class='selected' type='checkbox' name='inclusion' value='$mac'></td>";            if(isset($rows[0][0])){                foreach($rows[0] as $k=>$v){                    if($k!=0)                        echo "<td> $v </td>";                }                echo "<td>".getChallengeTakeFromUser($config,$rows[0]['0'],$sqlChallengeTaken)."</td>";                echo "<td>".getGamesPlayFromUser($config,$rows[0]['0'],$sqlGamesPlayed)."</td>";            }else{                echo "				        <td>$name</td><td>$mac</td>				        <td> -- </td><td> -- </td><td> -- </td><td> -- </td>				        ";            }            echo "</tr>";        }else{            echo "				        <tr><td><input class='selected' type='checkbox' name='inclusion' value='$mac'></td><td>$name</td><td>$mac</td>				        <td> -- </td><td> -- </td><td> -- </td><td> -- </td></tr>				        ";        }    }    echo "<tr>				<td colspan='3' style='text-align:right;'>				<button id='getChallenges' type='button' class='btn btn-primary' disabled='disabled' data-loading-text='Loading...'>Get Challenges</button></td></tr>				</tbody>				</table></div>				";endif;?><div id="showUSERDet" style="position: absolute;    right: 0;    width: 55%;"></div></div><?php  include "templates/foot.php";echo "        	 <script type=\"text/javascript\">        	 $(document).ready(function(){        	 	var usrNum = 0;        	 	var u1 = 0, u2 = 0;        	 	var mac = new Array();        	 	mac[0] = -1;        	 	mac[1] = -1;			 	$(\".listings tr:odd\").addClass(\"odd\");				                $(\"#table1 tr:not(.odd)\").addClass(\"even\");     	 		$('input.selected').change(function(){    	 			if ($(this).is(':radio[name=chalChoice]')){										        $('#selChallenges').removeAttr('disabled');				        return;				    }				    if ($(this).is(':radio[name=update1]')){    					u1 = 1;    					if(u2){    						$('#finalizeChallenge').removeAttr('disabled');    						$('#updateChallenge').removeAttr('disabled');    					}					        return;				    }					if ($(this).is(':radio[name=update2]'))	{    					u2 = 1;    					if(u1){    						$('#finalizeChallenge').removeAttr('disabled');    						$('#updateChallenge').removeAttr('disabled');    					}									        return;				    }    				if(this.checked){    					usrNum++;    					if(usrNum > 2){    						this.checked = false;							usrNum--;						} else {							$('#getChallenges').removeAttr('disabled');						}    				} else {    					usrNum--;    					if(!usrNum)    						$('#getChallenges').attr('disabled', 'disabled');    				}				});				$('#getChallenges').click(function(){					var mac = new Array();					var i = 0;					$('input.selected:checkbox[name=inclusion]:checked').each(function(){						mac[i] = \$(this).val();						//alert(mac[i] + \"   \" + i);						i++;					});					var urlmac= mac[0] + '+' + mac[1];			        window.location.href=\"index.php?pname=simulation&mac=\"+urlmac+\"\";					//window.location.href = \"/index.php?mac=\" + mac[0] +\"+\" + mac[1]+\"&pname=simulation\";				});				$('#selChallenges').click(function(){			        					var challengeID = $('input:radio[name=chalChoice]:checked').val();														window.location.href = window.location.href + '&cid=' + challengeID;					//alert(window.location.href + '&cid=' + challengeID);				});				$('#updateChallenge').click(function(){					var updater1 = $('input:radio[name=update1]:checked').val();					var updater2 = $('input:radio[name=update2]:checked').val();					window.location.href = window.location.href + '&update1=' + updater1 + '&update2=' + updater2+'&verify=verification';				});				$('#restart').click(function(){			        window.location.href=\"index.php?pname=simulation\";					//window.location.href = '/index.php?pname=simulation';				});				$('#updateChallenge_verify').click(function(){	    			var updater1 = $('input:hidden[name=update1]').val();					var updater2 = $('input:hidden[name=update2]').val();					window.location.href = window.location.href + '&update1=' + updater1 + '&update2=' + updater2+'&verify=verification-done';			    });			    /*$('input[name^=inclusion]').change(function(){			     //if($(this).val())			     mac=$(this).val();                  if($(this).is(':checked')){                    $.ajax({	                	url: 'userDetailsSimulation.php',		                type: 'POST',                        dataType: 'html',                        data: {                            mac : mac                        },                        success: function (response)                        {                         response=response;                            if (!response){                                alert(\"Opps!! Data didn't update! Something must be wrong..Please contact app admin.\");                            }else{                                $('#showUSERDet').html(response);                            }                        },                        error: function(XMLHttpRequest, textStatus, exception) { alert('Ajax failure' + exception); },                        async: true                    });                  }			    //alert($(this).is(':checked')+\"Selected\");			    });*/        	 });          </script>";?>